<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>THE INDEX: PRESCRIPT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">

  <style>
    :root {
      --index-blue: #a0eaff;
      --index-red: #ff3b3b;
      --current-theme: var(--index-blue);
    }

    html, body { 
      margin: 0; height: 100%; 
      background-color: #020202; 
      color: var(--current-theme);
      font-family: 'Pixelify Sans', sans-serif; 
      display: flex; justify-content: center; align-items: center;
      overflow: hidden; transition: color 0.5s ease;
    }

    body::before {
      content: " "; display: block; position: absolute;
      top: 0; left: 0; bottom: 0; right: 0;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.2) 50%), 
                  linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
      z-index: 100; background-size: 100% 4px, 4px 100%; pointer-events: none;
    }

    #container {
      text-align: center; padding: 40px; width: 90%; max-width: 800px;
      position: relative; z-index: 10;
    }

    #header { 
      font-size: 14px; letter-spacing: 3px; margin-bottom: 20px; opacity: 0.6; 
      text-shadow: 0 0 5px var(--current-theme); 
    }

    #logo {
      width: 120px; height: auto; margin-bottom: 20px;
      opacity: 0.8;
    }
    
    #prescript-text { 
      font-size: 24px; line-height: 1.6; min-height: 180px; 
      text-shadow: 0 0 5px var(--current-theme); 
      font-weight: 500;
      transition: color 0.5s ease;
    }

    #action-btn {
      margin-top: 30px;
      padding: 12px 30px;
      background: transparent;
      border: 1px solid var(--current-theme);
      color: var(--current-theme);
      font-family: 'Pixelify Sans', sans-serif;
      font-size: 18px;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 2px;
      transition: all 0.3s ease;
      animation: pulse 2.5s infinite;
    }

    #action-btn:hover {
      background: var(--current-theme);
      color: #020202;
      box-shadow: 0 0 20px var(--current-theme);
    }

    @keyframes pulse {
      0% { opacity: 0.3; }
      50% { opacity: 1; }
      100% { opacity: 0.3; }
    }

    .cursor {
      display: inline-block; width: 12px; height: 22px;
      background-color: var(--current-theme); margin-left: 5px;
      vertical-align: middle; animation: blink 0.5s step-end infinite;
    }

    @keyframes blink { 50% { opacity: 0; } }
  </style>
</head>

<body>
  <div id="container">
    <div id="header">THE WILL OF THE CITY</div>
    <img id="logo" src="index_logo.png" alt="THE INDEX LOGO">
    <div id="prescript-text">...Waiting for input...</div>
    <button id="action-btn">Click to Receive</button>
  </div>

  <script>
    const dictionary = {
      action: ["Talk to", "Hand a coin to", "Whisper to", "Follow", "Nod at", "Blink at", "Point toward", "Avoid", "Touch the shoulder of", "Trace a circle near"],
      who: ["a man in a dark coat", "the first woman you see", "a stranger with a hat", "a child playing alone", "someone leaning against a wall", "a person looking at their phone", "the nearest Proxy", "a shopkeeper", "someone walking quickly", "a man with glasses"],
      when: ["when the clock strikes 3", "during the start of the evening", "after the sun goes down", "when you hear a bird chirp", "as soon as you see a red car", "while the streetlights flicker", "exactly 10 minutes from now", "when the wind picks up", "at the moment of sunset"],
      topic: ["about your oldest memory", "regarding the Will of the City", "about a secret you kept", "about the color of the sky", "regarding your current debt", "about a dream you had", "concerning the Index", "about things that don't matter", "regarding your next move"],
      where: ["near the nearest drainage pipe.", "inside a quiet hallway.", "at the center of the intersection.", "under the shadow of a tall building.", "while standing on one leg.", "without making any eye contact.", "and then walk away immediately.", "until the transition is complete."]
    };

    const displayElement = document.getElementById('prescript-text');
    const actionBtn = document.getElementById('action-btn');
    // Updated characters to include lowercase
    const fullCharset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    let isClearState = false;

    function generatePrescript() {
      if (Math.random() < 0.10) {
        document.documentElement.style.setProperty('--current-theme', 'var(--index-red)');
        return "CRITICAL: DO NOT ATTEMPT TO INTERPRET THE WILL. CEASE ALL MOVEMENT.";
      }
      document.documentElement.style.setProperty('--current-theme', 'var(--index-blue)');
      const d = dictionary;
      const res = [d.action, d.who, d.when, d.topic, d.where].map(list => list[Math.floor(Math.random() * list.length)]);
      return res.join(" ");
    }

    function decodeText(text, callback) {
      let iterations = 0;
      const interval = setInterval(() => {
        displayElement.innerHTML = text.split("").map((char, index) => {
          if (index < iterations) return text[index];
          // Using lowercase + uppercase + symbols for scrambling
          return fullCharset[Math.floor(Math.random() * fullCharset.length)];
        }).join("") + '<span class="cursor"></span>';

        if (iterations >= text.length) {
          clearInterval(interval);
          if(callback) callback();
        }
        iterations += 0.8; 
      }, 20); 
    }

    function scrambleAndClear() {
      const clearText = "_CLEAR._";
      let iterations = 0;
      
      const interval = setInterval(() => {
        displayElement.innerHTML = clearText.split("").map((char, index) => {
          if (index < iterations) return clearText[index];
          return fullCharset[Math.floor(Math.random() * fullCharset.length)];
        }).join("") + '<span class="cursor"></span>';

        if (iterations >= clearText.length) {
          clearInterval(interval);
          setTimeout(() => {
            const nextWill = generatePrescript();
            decodeText(nextWill);
          }, 1000);
        }
        iterations += 0.3;
      }, 50);
    }

    actionBtn.addEventListener('click', () => {
      if (!isClearState) {
        const finalWill = generatePrescript();
        decodeText(finalWill);
        actionBtn.innerText = "Clear";
        isClearState = true;
      } else {
        scrambleAndClear();
      }
    });
  </script>
</body>
</html>
